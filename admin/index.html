<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	
	<title id="page-title">Admin</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  
            <div class="container text-center">
                <h2>Welcome <span id="admin_name"> </span>  </h2>
       <p><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" >Add New Link </button> &nbsp;&nbsp;
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal3" >Add Social Link </button> &nbsp;&nbsp; 
        <button type="button" class="btn btn-success" id="btn_add_col" data-toggle="modal" data-target="#exampleModal2">Template</button>&nbsp;&nbsp; &nbsp; 
        <button type="button" class="btn btn-danger" id="btn_logout">Logout</button>
         
        </p>      
		    
		    <table class="table table-striped guides">
                 <div class="alert alert-success">
       your site is published at <a id="user-link"></a>
			<br> <a id="invite-link" >Invite Friends</a>
                  </div>
                  <tbody>
                   
                   
                  </tbody>
                </table>
              </div>
	
	
	
          <!-- Model open after click add link -->     
         
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New Link/Button</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Title:</label>
            <input type="text" class="form-control" id="title">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Your Link:</label>
            <input type="text" class="form-control" id="link" value="https://" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" id="btn_add">Save</button>
      </div>
    </div>
  </div>
</div>      
    
 <!-- Model open after click add social link -->     
         
 <div class="modal fade" id="exampleModal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New Social Button</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Social:</label>
            <select class="form-control" id="social-type">
              <option value="Facebook">Facebook</option> 
            <option value="Instagram">Instagram</option> 
            <option value="Github">Github</option> //
            <option value="Youtube">Youtube</option>
            <option value="Twitter">Twitter</option>
            <option value="Snapchat">Snapchat</option>
            <option value="Linkedin">LinkedIn</option>
            <option value="Tiktok">TikTok</option>
          </select>
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Your Profile Link:</label>
            <input type="text" class="form-control" id="link-social" value="https://" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" id="btn_add_social">Save</button>
      </div>
    </div>
  </div>
</div>      
<!-- Model open after click Template -->    
<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Update Template</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-xs-12 text-center">
          <label class="image-radio">
              <img class="img-responsive" src="1.png" />
              <input type="radio" name="image_radio" id="r1" value="1" />
              <i class="glyphicon glyphicon-ok hidden"></i>
          </label>
      </div>
      <div class="col-xs-12 text-center">
          <label class="image-radio">
              <img class="img-responsive" src="2.png" />
              <input type="radio" name="image_radio" id="r2" value="2" />
              <i class="glyphicon glyphicon-ok hidden"></i>
          </label>
      </div>
      <div class="col-xs-12 nopad text-center">
          <label class="image-radio">
              <img class="img-responsive" src="3.png" />
              <input type="radio" name="image_radio" id="r3" value="3" />
              <i class="glyphicon glyphicon-ok hidden"></i>
          </label>
      </div>
      <div class="col-xs-12 nopad text-center">
          <label class="image-radio">
              <img class="img-responsive" src="4.png" />
              <input type="radio" name="image_radio" id="r4" value="4" />
              <i class="glyphicon glyphicon-ok hidden"></i>
          </label>
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" id="update_temp">Update Template</button>
      </div>
    </div>
  </div>
</div>      
      
<script>
 $(document).ready(function(){
    // add/remove checked class
    $(".image-radio").each(function(){
        if($(this).find('input[type="radio"]').first().attr("checked")){
            $(this).addClass('image-radio-checked');
        }else{
            $(this).removeClass('image-radio-checked');
        }
    });

    // sync the input state
    $(".image-radio").on("click", function(e){
        $(".image-radio").removeClass('image-radio-checked');
        $(this).addClass('image-radio-checked');
        var $radio = $(this).find('input[type="radio"]');
        $radio.prop("checked",!$radio.prop("checked"));

        e.preventDefault();
    });
});

  </script>	
	
	
	
        <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-firestore.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>  
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBv6yIMLAPO2AsrQDSMCuNSzWQKeGgUq5A",
        authDomain: "test-18579.firebaseapp.com",
        databaseURL: "https://test-18579.firebaseio.com",
        projectId: "test-18579",
        storageBucket: "test-18579.appspot.com",
        messagingSenderId: "119631748247",
        appId: "1:119631748247:web:79ba28cac84bdc4a"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var auth=firebase.auth();
    const db=firebase.firestore();

    

    </script>



<script>  
	
firebase.auth().onAuthStateChanged(user=>{ 

  if(user){
   const user_mail= user.email;
	  //search username
	  
db.collection("users").where("Email", "==", user_mail)
    .get()
    .then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
            // doc.data() is never undefined for query doc snapshots
            const user_name=doc.id;
		//User Dyanamic Link
	  const cust_link="LinkC/"+user_name;
	  document.getElementById('user-link').innerHTML=cust_link;
	 document.getElementById('user-link').href="http://link-keep-er.herokuapp.com/"+cust_link;
	const invite="whatsapp://send?text=Have a look on My Awesome Webpage : "+"http://link-keep-er.herokuapp.com/"+cust_link+"                                                                    Try it for free!! Sign up now  *linkc.madhaba.me*                                                                          Contact- madhabapatra@gmail.com";
         document.getElementById('invite-link').href=invite;
     console.log(user_name);
	  
		//
	  
	  // search for user
    var docRef = db.collection("users").doc(user_name);

    docRef.get().then(function(doc) {
        if (doc.exists) {
           console.log(doc.data());
		document.getElementById('admin_name').innerHTML=doc.data().Username;
                  
		document.getElementById('page-title').innerHTML=doc.data().Username;
		
		
		 //Action button to  Delete  Link
var parent=document.querySelector('.guides');
     parent.addEventListener('click',DeleteLink,false);
     function DeleteLink(e){
       
       if(e.target !=e.currentTarget){
         var clickedbtn=e.target.id;
      // Delete button Perform
     if(e.target.textContent=="Delete"){
       db.collection('users').doc(user_name).collection('user-button').doc(clickedbtn).delete().then(function() {
    console.log("Document successfully deleted!");
    window.location="index.html";
}).catch(function(error) {
    console.error("Error removing document: ", error);
});
}
	       }
       e.stopPropagation();
     }
		
		// List of Buttons which is created bu user
		
		 db.collection('users').doc(user_name).collection('user-button').get().then(snapshot => {
   
   setupGuides(snapshot.docs);
 }) ;
 
const guideList= document.querySelector('.guides');

 const setupGuides= (data) =>{
  let html='';
   const head=`
   <thead>
                    <tr>
                     
                      <th>Titles</th>
                      <th>Links</th>
                      <th>DELETE BUTTON</th>
                    </tr>
                  </thead>
   `;
   html+=head;
  data.forEach(docs=> {
    const users=docs.data();
    const id=docs.id;
    const li= `
    <tr>
    <td>   
     ${users.Title} 
     </td>
    
     <td>
     <a href=' ${users.Link}
     ' target='_blank'> ${users.Link}</a>
     </td>
     <td>
        <button type="button" class="btn btn-danger" id="${id}" >Delete</button>
     </td>
     </tr>
     
    `;
    
    html+=li
  });
  guideList.innerHTML=html;
  
 }
		
        } // if docs exist closed
	    else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
        }
   	  
	 }) 
        });
    })
    .catch(function(error) {
        console.log("Error getting documents: ", error);
    });

	  
  }
  else {
   window.location='../Login/index.html';
  }
});


     </script>
    

<script>  

document.getElementById("btn_logout").addEventListener('click', e=>{
  firebase.auth().signOut();
  
})
 </script>


<script>  
	
firebase.auth().onAuthStateChanged(user=>{ 

  if(user){
   const user_mail= user.email;
	  db.collection("users").where("Email", "==", user_mail)
    .get()
    .then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
            // doc.data() is never undefined for query doc snapshots
            const user_name=doc.id;
		console.log(user_name)
		    // add new link to user button 
	 document.getElementById("btn_add").addEventListener('click', e=>{
   const title=document.getElementById('title').value;
	 const link=document.getElementById('link').value;
      db.collection('users').doc(user_name).collection('user-button').add({
          Type: "custom" ,
          Title: profile,
          Link: link
           })
        .then(function(docRef) {
        window.location='index.html';
             }) 
	 
	 
   }) // end of btn_add event
   
	   // add Social link to user button 
	 document.getElementById("btn_add_social").addEventListener('click', e=>{
   const profile=document.getElementById('social-type').value;
   const Title= "@"+document.getElementById('social-type').value;
	 const link=document.getElementById('link-social').value;
      db.collection('users').doc(user_name).collection('user-button').add({
          Type: title,
          Title: profile,
          Link: link
           })
        .then(function(docRef) {
        window.location='index.html';
             }) 
	 
	 
	 }) // end of btn_add event
	  // set template color 
        document.getElementById("update_temp").addEventListener('click', e=>{
         var rate_value;
          if (document.getElementById('r1').checked) {
        rate_value = document.getElementById('r1').value;
        }
        else if (document.getElementById('r2').checked) {
          rate_value = document.getElementById('r2').value;
        } 
        else if (document.getElementById('r3').checked) {
          rate_value = document.getElementById('r3').value;
        }
        else if(document.getElementById('r4').checked) {
          rate_value = document.getElementById('r4').value;
        }

      var colorRef = db.collection("users").doc(user_name);

          return colorRef.update({
              col: rate_value
        })
         .then(function() {
    console.log("Document successfully updated!");
window.location='index.html';
             })
	 
	 }) // end of update_temp event
        })
    })


  
   } //user end
}) //auth end

</script>


</body>
</html>
